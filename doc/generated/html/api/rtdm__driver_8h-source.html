<!DOCTYPE HTML PUBLIC "-//W3C//DTD HTML 4.01 Transitional//EN">
<html><head><meta http-equiv="Content-Type" content="text/html;charset=iso-8859-1">
<title>Xenomai API: skins/rtdm/rtdm_driver.h Source File</title>
<link href="doxygen.css" rel="stylesheet" type="text/css">
</head><body>
<!-- Generated by Doxygen 1.4.2 -->
<div class="qindex">  <form class="search" action="search.php" method="get">
<a class="qindex" href="main.html">Main&nbsp;Page</a> | <a class="qindex" href="modules.html">Modules</a> | <a class="qindex" href="annotated.html">Data&nbsp;Structures</a> | <a class="qindex" href="dirs.html">Directories</a> | <a class="qindex" href="files.html">File&nbsp;List</a> | <a class="qindex" href="functions.html">Data&nbsp;Fields</a> | <a class="qindex" href="globals.html">Globals</a>  | <span class="search"><u>S</u>earch&nbsp;for&nbsp;<input class="search" type="text" name="query" value="" size="20" accesskey="s"/></span></form></div>
<div class="nav">
<a class="el" href="dir_000018.html">skins</a>&nbsp;/&nbsp;<a class="el" href="dir_000020.html">rtdm</a></div>
<h1>rtdm_driver.h</h1><a href="rtdm__driver_8h.html">Go to the documentation of this file.</a><div class="fragment"><pre class="fragment">00001 
00025 <span class="preprocessor">#ifndef _RTDM_DRIVER_H</span>
00026 <span class="preprocessor"></span><span class="preprocessor">#define _RTDM_DRIVER_H</span>
00027 <span class="preprocessor"></span>
00028 <span class="preprocessor">#ifndef __KERNEL__</span>
00029 <span class="preprocessor"></span><span class="preprocessor">#error This header is for kernel space usage only. \</span>
00030 <span class="preprocessor">       You are likely looking for rtdm/rtdm.h...</span>
00031 <span class="preprocessor"></span><span class="preprocessor">#endif </span><span class="comment">/* !__KERNEL__ */</span>
00032 
00033 <span class="preprocessor">#include &lt;asm/atomic.h&gt;</span>
00034 <span class="preprocessor">#include &lt;linux/list.h&gt;</span>
00035 
00036 <span class="preprocessor">#include &lt;nucleus/xenomai.h&gt;</span>
00037 <span class="preprocessor">#include &lt;nucleus/core.h&gt;</span>
00038 <span class="preprocessor">#include &lt;nucleus/heap.h&gt;</span>
00039 <span class="preprocessor">#include &lt;<a class="code" href="pod_8h.html">nucleus/pod.h</a>&gt;</span>
00040 <span class="preprocessor">#include &lt;nucleus/synch.h&gt;</span>
00041 <span class="preprocessor">#include &lt;<a class="code" href="rtdm_8h.html">rtdm/rtdm.h</a>&gt;</span>
00042 
00043 
00044 <span class="keyword">struct </span><a class="code" href="structrtdm__dev__context.html">rtdm_dev_context</a>;
00045 
00046 
<a name="l00055"></a><a class="code" href="rtdm__driver_8h.html#a0">00055</a> <span class="preprocessor">#define RTDM_EXCLUSIVE              0x0001</span>
00056 <span class="preprocessor"></span>
<a name="l00058"></a><a class="code" href="rtdm__driver_8h.html#a1">00058</a> <span class="preprocessor">#define RTDM_NAMED_DEVICE           0x0010</span>
00059 <span class="preprocessor"></span>
<a name="l00062"></a><a class="code" href="rtdm__driver_8h.html#a2">00062</a> <span class="preprocessor">#define RTDM_PROTOCOL_DEVICE        0x0020</span>
00063 <span class="preprocessor"></span>
<a name="l00065"></a><a class="code" href="rtdm__driver_8h.html#a3">00065</a> <span class="preprocessor">#define RTDM_DEVICE_TYPE_MASK       0x00F0</span>
00066 <span class="preprocessor"></span>
<a name="l00076"></a><a class="code" href="rtdm__driver_8h.html#a4">00076</a> <span class="preprocessor">#define RTDM_CREATED_IN_NRT         0</span>
00077 <span class="preprocessor"></span>
<a name="l00079"></a><a class="code" href="rtdm__driver_8h.html#a5">00079</a> <span class="preprocessor">#define RTDM_CLOSING                1</span>
00080 <span class="preprocessor"></span>
<a name="l00083"></a><a class="code" href="rtdm__driver_8h.html#a6">00083</a> <span class="preprocessor">#define RTDM_FORCED_CLOSING         2</span>
00084 <span class="preprocessor"></span>
<a name="l00086"></a><a class="code" href="rtdm__driver_8h.html#a7">00086</a> <span class="preprocessor">#define RTDM_USER_CONTEXT_FLAG      8   </span><span class="comment">/* first user-definable flag */</span>
00087 
<a name="l00098"></a><a class="code" href="rtdm__driver_8h.html#a8">00098</a> <span class="preprocessor">#define RTDM_DEVICE_STRUCT_VER      3</span>
00099 <span class="preprocessor"></span>
<a name="l00101"></a><a class="code" href="rtdm__driver_8h.html#a9">00101</a> <span class="preprocessor">#define RTDM_CONTEXT_STRUCT_VER     3</span>
00102 <span class="preprocessor"></span>
<a name="l00104"></a><a class="code" href="rtdm__driver_8h.html#a10">00104</a> <span class="preprocessor">#define RTDM_API_VER                3</span>
00105 <span class="preprocessor"></span>
<a name="l00107"></a><a class="code" href="rtdm__driver_8h.html#a11">00107</a> <span class="preprocessor">#define RTDM_API_MIN_COMPAT_VER     3</span>
00108 <span class="preprocessor"></span>
<a name="l00110"></a><a class="code" href="rtdm__driver_8h.html#a12">00110</a> <span class="preprocessor">#define RTDM_SECURE_DEVICE          0x80000000</span>
00111 <span class="preprocessor"></span>
<a name="l00113"></a><a class="code" href="rtdm__driver_8h.html#a13">00113</a> <span class="preprocessor">#define RTDM_DRIVER_VER(major, minor, patch) \</span>
00114 <span class="preprocessor">    (((major &amp; 0xFF) &lt;&lt; 16) | ((minor &amp; 0xFF) &lt;&lt; 8) | (patch &amp; 0xFF))</span>
00115 <span class="preprocessor"></span>
<a name="l00117"></a><a class="code" href="rtdm__driver_8h.html#a14">00117</a> <span class="preprocessor">#define RTDM_DRIVER_MAJOR_VER(ver)  (((ver) &gt;&gt; 16) &amp; 0xFF)</span>
00118 <span class="preprocessor"></span>
<a name="l00120"></a><a class="code" href="rtdm__driver_8h.html#a15">00120</a> <span class="preprocessor">#define RTDM_DRIVER_MINOR_VER(ver)  (((ver) &gt;&gt; 8) &amp; 0xFF)</span>
00121 <span class="preprocessor"></span>
<a name="l00123"></a><a class="code" href="rtdm__driver_8h.html#a16">00123</a> <span class="preprocessor">#define RTDM_DRIVER_PATCH_VER(ver) ((ver) &amp; 0xFF)</span>
00124 <span class="preprocessor"></span>
00145 <span class="keyword">typedef</span>
<a name="l00146"></a><a class="code" href="rtdm__driver_8h.html#a54">00146</a>     int     (*<a class="code" href="rtdm__driver_8h.html#a54">rtdm_open_handler_t</a>)   (<span class="keyword">struct </span><a class="code" href="structrtdm__dev__context.html">rtdm_dev_context</a>   *context,
00147                                       rtdm_user_info_t          *user_info,
00148                                       <span class="keywordtype">int</span>                       oflag);
00149 
00162 <span class="keyword">typedef</span>
<a name="l00163"></a><a class="code" href="rtdm__driver_8h.html#a55">00163</a>     int     (*<a class="code" href="rtdm__driver_8h.html#a55">rtdm_socket_handler_t</a>) (<span class="keyword">struct </span><a class="code" href="structrtdm__dev__context.html">rtdm_dev_context</a>   *context,
00164                                       rtdm_user_info_t          *user_info,
00165                                       <span class="keywordtype">int</span>                       protocol);
00166 
00178 <span class="keyword">typedef</span>
<a name="l00179"></a><a class="code" href="rtdm__driver_8h.html#a56">00179</a>     int     (*<a class="code" href="rtdm__driver_8h.html#a56">rtdm_close_handler_t</a>)  (<span class="keyword">struct </span><a class="code" href="structrtdm__dev__context.html">rtdm_dev_context</a>   *context,
00180                                       rtdm_user_info_t          *user_info);
00181 
00195 <span class="keyword">typedef</span>
<a name="l00196"></a><a class="code" href="rtdm__driver_8h.html#a57">00196</a>     int     (*<a class="code" href="rtdm__driver_8h.html#a57">rtdm_ioctl_handler_t</a>)  (<span class="keyword">struct </span><a class="code" href="structrtdm__dev__context.html">rtdm_dev_context</a>   *context,
00197                                       rtdm_user_info_t          *user_info,
00198                                       <span class="keywordtype">int</span>                       request,
00199                                       <span class="keywordtype">void</span>                      *arg);
00200 
00214 <span class="keyword">typedef</span>
<a name="l00215"></a><a class="code" href="rtdm__driver_8h.html#a58">00215</a>     ssize_t (*<a class="code" href="rtdm__driver_8h.html#a58">rtdm_read_handler_t</a>)   (<span class="keyword">struct </span><a class="code" href="structrtdm__dev__context.html">rtdm_dev_context</a>   *context,
00216                                       rtdm_user_info_t          *user_info,
00217                                       <span class="keywordtype">void</span>                      *buf,
00218                                       size_t                    nbyte);
00219 
00234 <span class="keyword">typedef</span>
<a name="l00235"></a><a class="code" href="rtdm__driver_8h.html#a59">00235</a>     ssize_t (*<a class="code" href="rtdm__driver_8h.html#a59">rtdm_write_handler_t</a>)  (<span class="keyword">struct </span><a class="code" href="structrtdm__dev__context.html">rtdm_dev_context</a>   *context,
00236                                       rtdm_user_info_t          *user_info,
00237                                       <span class="keyword">const</span> <span class="keywordtype">void</span>                *buf,
00238                                       size_t                    nbyte);
00239 
00255 <span class="keyword">typedef</span>
<a name="l00256"></a><a class="code" href="rtdm__driver_8h.html#a60">00256</a>     ssize_t (*<a class="code" href="rtdm__driver_8h.html#a60">rtdm_recvmsg_handler_t</a>)(<span class="keyword">struct </span><a class="code" href="structrtdm__dev__context.html">rtdm_dev_context</a>   *context,
00257                                       rtdm_user_info_t          *user_info,
00258                                       <span class="keyword">struct </span>msghdr             *msg,
00259                                       <span class="keywordtype">int</span>                       flags);
00260 
00276 <span class="keyword">typedef</span>
<a name="l00277"></a><a class="code" href="rtdm__driver_8h.html#a61">00277</a>     ssize_t (*<a class="code" href="rtdm__driver_8h.html#a61">rtdm_sendmsg_handler_t</a>)(<span class="keyword">struct </span><a class="code" href="structrtdm__dev__context.html">rtdm_dev_context</a>   *context,
00278                                       rtdm_user_info_t          *user_info,
00279                                       <span class="keyword">const</span> <span class="keyword">struct </span>msghdr       *msg,
00280                                       <span class="keywordtype">int</span>                       flags);
00283 <span class="keyword">typedef</span>
00284     int     (*rtdm_rt_handler_t)     (<span class="keyword">struct </span><a class="code" href="structrtdm__dev__context.html">rtdm_dev_context</a>   *context,
00285                                       rtdm_user_info_t          *user_info,
00286                                       <span class="keywordtype">void</span>                      *arg);
00287 
00288 
<a name="l00293"></a><a class="code" href="structrtdm__operations.html">00293</a> <span class="keyword">struct </span><a class="code" href="structrtdm__operations.html">rtdm_operations</a> {
<a name="l00298"></a><a class="code" href="structrtdm__operations.html#z31_0">00298</a>     <a class="code" href="rtdm__driver_8h.html#a56">rtdm_close_handler_t</a>            <a class="code" href="structrtdm__operations.html#z31_0">close_rt</a>;
<a name="l00301"></a><a class="code" href="structrtdm__operations.html#z31_1">00301</a>     <a class="code" href="rtdm__driver_8h.html#a56">rtdm_close_handler_t</a>            <a class="code" href="structrtdm__operations.html#z31_1">close_nrt</a>;
<a name="l00303"></a><a class="code" href="structrtdm__operations.html#z31_2">00303</a>     <a class="code" href="rtdm__driver_8h.html#a57">rtdm_ioctl_handler_t</a>            <a class="code" href="structrtdm__operations.html#z31_2">ioctl_rt</a>;
<a name="l00305"></a><a class="code" href="structrtdm__operations.html#z31_3">00305</a>     <a class="code" href="rtdm__driver_8h.html#a57">rtdm_ioctl_handler_t</a>            <a class="code" href="structrtdm__operations.html#z31_3">ioctl_nrt</a>;
<a name="l00311"></a><a class="code" href="structrtdm__operations.html#z32_0">00311</a>     <a class="code" href="rtdm__driver_8h.html#a58">rtdm_read_handler_t</a>             <a class="code" href="structrtdm__operations.html#z32_0">read_rt</a>;
<a name="l00313"></a><a class="code" href="structrtdm__operations.html#z32_1">00313</a>     <a class="code" href="rtdm__driver_8h.html#a58">rtdm_read_handler_t</a>             <a class="code" href="structrtdm__operations.html#z32_1">read_nrt</a>;
<a name="l00315"></a><a class="code" href="structrtdm__operations.html#z32_2">00315</a>     <a class="code" href="rtdm__driver_8h.html#a59">rtdm_write_handler_t</a>            <a class="code" href="structrtdm__operations.html#z32_2">write_rt</a>;
<a name="l00317"></a><a class="code" href="structrtdm__operations.html#z32_3">00317</a>     <a class="code" href="rtdm__driver_8h.html#a59">rtdm_write_handler_t</a>            <a class="code" href="structrtdm__operations.html#z32_3">write_nrt</a>;
<a name="l00323"></a><a class="code" href="structrtdm__operations.html#z33_0">00323</a>     <a class="code" href="rtdm__driver_8h.html#a60">rtdm_recvmsg_handler_t</a>          <a class="code" href="structrtdm__operations.html#z33_0">recvmsg_rt</a>;
<a name="l00325"></a><a class="code" href="structrtdm__operations.html#z33_1">00325</a>     <a class="code" href="rtdm__driver_8h.html#a60">rtdm_recvmsg_handler_t</a>          <a class="code" href="structrtdm__operations.html#z33_1">recvmsg_nrt</a>;
<a name="l00327"></a><a class="code" href="structrtdm__operations.html#z33_2">00327</a>     <a class="code" href="rtdm__driver_8h.html#a61">rtdm_sendmsg_handler_t</a>          <a class="code" href="structrtdm__operations.html#z33_2">sendmsg_rt</a>;
<a name="l00329"></a><a class="code" href="structrtdm__operations.html#z33_3">00329</a>     <a class="code" href="rtdm__driver_8h.html#a61">rtdm_sendmsg_handler_t</a>          <a class="code" href="structrtdm__operations.html#z33_3">sendmsg_nrt</a>;
00331 };
00332 
<a name="l00344"></a><a class="code" href="structrtdm__dev__context.html">00344</a> <span class="keyword">struct </span><a class="code" href="structrtdm__dev__context.html">rtdm_dev_context</a> {
<a name="l00346"></a><a class="code" href="structrtdm__dev__context.html#o0">00346</a>     <span class="keywordtype">unsigned</span> <span class="keywordtype">long</span>                   <a class="code" href="structrtdm__dev__context.html#o0">context_flags</a>;
<a name="l00348"></a><a class="code" href="structrtdm__dev__context.html#o1">00348</a>     <span class="keywordtype">int</span>                             <a class="code" href="structrtdm__dev__context.html#o1">fd</a>;
<a name="l00351"></a><a class="code" href="structrtdm__dev__context.html#o2">00351</a>     atomic_t                        <a class="code" href="structrtdm__dev__context.html#o2">close_lock_count</a>;
<a name="l00353"></a><a class="code" href="structrtdm__dev__context.html#o3">00353</a>     <span class="keyword">struct </span><a class="code" href="structrtdm__operations.html">rtdm_operations</a>          *<a class="code" href="structrtdm__dev__context.html#o3">ops</a>;
<a name="l00355"></a><a class="code" href="structrtdm__dev__context.html#o4">00355</a>     <span class="keyword">volatile</span> <span class="keyword">struct </span><a class="code" href="structrtdm__device.html">rtdm_device</a>     *<a class="code" href="structrtdm__dev__context.html#o4">device</a>;
<a name="l00357"></a><a class="code" href="structrtdm__dev__context.html#o5">00357</a>     <span class="keywordtype">char</span>                            <a class="code" href="structrtdm__dev__context.html#o5">dev_private</a>[0];
00358 };
00359 
00360 <span class="keyword">struct </span>rtdm_dev_reserved {
00361     <span class="keyword">struct </span>list_head                entry;
00362     atomic_t                        refcount;
00363     <span class="keyword">struct </span><a class="code" href="structrtdm__dev__context.html">rtdm_dev_context</a>         *exclusive_context;
00364 };
00365 
<a name="l00374"></a><a class="code" href="structrtdm__device.html">00374</a> <span class="keyword">struct </span><a class="code" href="structrtdm__device.html">rtdm_device</a> {
<a name="l00377"></a><a class="code" href="structrtdm__device.html#o0">00377</a>     <span class="keywordtype">int</span>                             <a class="code" href="structrtdm__device.html#o0">struct_version</a>;
00378 
<a name="l00380"></a><a class="code" href="structrtdm__device.html#o1">00380</a>     <span class="keywordtype">int</span>                             <a class="code" href="structrtdm__device.html#o1">device_flags</a>;
<a name="l00382"></a><a class="code" href="structrtdm__device.html#o2">00382</a>     size_t                          <a class="code" href="structrtdm__device.html#o2">context_size</a>;
00383 
<a name="l00385"></a><a class="code" href="structrtdm__device.html#o3">00385</a>     <span class="keywordtype">char</span>                            <a class="code" href="structrtdm__device.html#o3">device_name</a>[<a class="code" href="rtdm_8h.html#a0">RTDM_MAX_DEVNAME_LEN</a>+1];
00386 
<a name="l00388"></a><a class="code" href="structrtdm__device.html#o4">00388</a>     <span class="keywordtype">int</span>                             <a class="code" href="structrtdm__device.html#o4">protocol_family</a>;
<a name="l00390"></a><a class="code" href="structrtdm__device.html#o5">00390</a>     <span class="keywordtype">int</span>                             <a class="code" href="structrtdm__device.html#o5">socket_type</a>;
00391 
<a name="l00394"></a><a class="code" href="structrtdm__device.html#o6">00394</a>     <a class="code" href="rtdm__driver_8h.html#a54">rtdm_open_handler_t</a>             <a class="code" href="structrtdm__device.html#o6">open_rt</a>;
<a name="l00397"></a><a class="code" href="structrtdm__device.html#o7">00397</a>     <a class="code" href="rtdm__driver_8h.html#a54">rtdm_open_handler_t</a>             <a class="code" href="structrtdm__device.html#o7">open_nrt</a>;
00398 
<a name="l00401"></a><a class="code" href="structrtdm__device.html#o8">00401</a>     <a class="code" href="rtdm__driver_8h.html#a55">rtdm_socket_handler_t</a>           <a class="code" href="structrtdm__device.html#o8">socket_rt</a>;
<a name="l00404"></a><a class="code" href="structrtdm__device.html#o9">00404</a>     <a class="code" href="rtdm__driver_8h.html#a55">rtdm_socket_handler_t</a>           <a class="code" href="structrtdm__device.html#o9">socket_nrt</a>;
00405 
<a name="l00407"></a><a class="code" href="structrtdm__device.html#o10">00407</a>     <span class="keyword">struct </span><a class="code" href="structrtdm__operations.html">rtdm_operations</a>          ops;
00408 
<a name="l00410"></a><a class="code" href="structrtdm__device.html#o11">00410</a>     <span class="keywordtype">int</span>                             <a class="code" href="structrtdm__device.html#o11">device_class</a>;
<a name="l00413"></a><a class="code" href="structrtdm__device.html#o12">00413</a>     <span class="keywordtype">int</span>                             <a class="code" href="structrtdm__device.html#o12">device_sub_class</a>;
<a name="l00415"></a><a class="code" href="structrtdm__device.html#o13">00415</a>     <span class="keyword">const</span> <span class="keywordtype">char</span>                      *<a class="code" href="structrtdm__device.html#o13">driver_name</a>;
<a name="l00417"></a><a class="code" href="structrtdm__device.html#o14">00417</a>     <span class="keywordtype">int</span>                             <a class="code" href="structrtdm__device.html#o14">driver_version</a>;
<a name="l00420"></a><a class="code" href="structrtdm__device.html#o15">00420</a>     <span class="keyword">const</span> <span class="keywordtype">char</span>                      *<a class="code" href="structrtdm__device.html#o15">peripheral_name</a>;
<a name="l00422"></a><a class="code" href="structrtdm__device.html#o16">00422</a>     <span class="keyword">const</span> <span class="keywordtype">char</span>                      *<a class="code" href="structrtdm__device.html#o16">provider_name</a>;
00423 
<a name="l00425"></a><a class="code" href="structrtdm__device.html#o17">00425</a>     <span class="keyword">const</span> <span class="keywordtype">char</span>                      *<a class="code" href="structrtdm__device.html#o17">proc_name</a>;
<a name="l00427"></a><a class="code" href="structrtdm__device.html#o18">00427</a>     <span class="keyword">struct </span>proc_dir_entry           *<a class="code" href="structrtdm__device.html#o18">proc_entry</a>;
00428 
<a name="l00430"></a><a class="code" href="structrtdm__device.html#o19">00430</a>     <span class="keywordtype">int</span>                             <a class="code" href="structrtdm__device.html#o19">device_id</a>;
00431 
<a name="l00433"></a><a class="code" href="structrtdm__device.html#o20">00433</a>     <span class="keyword">struct </span>rtdm_dev_reserved        reserved;
00434 };
00435 
00436 
00437 <span class="comment">/* --- device registration --- */</span>
00438 
00439 <span class="keywordtype">int</span> <a class="code" href="group__devregister.html#ga0">rtdm_dev_register</a>(<span class="keyword">struct</span> <a class="code" href="structrtdm__device.html">rtdm_device</a>* device);
00440 <span class="keywordtype">int</span> <a class="code" href="group__devregister.html#ga1">rtdm_dev_unregister</a>(<span class="keyword">struct</span> <a class="code" href="structrtdm__device.html">rtdm_device</a>* device, <span class="keywordtype">unsigned</span> <span class="keywordtype">int</span> poll_delay);
00441 
00442 
00443 <span class="comment">/* --- inter-driver API --- */</span>
00444 
00445 <span class="preprocessor">#define rtdm_open                   rt_dev_open</span>
00446 <span class="preprocessor"></span><span class="preprocessor">#define rtdm_socket                 rt_dev_socket</span>
00447 <span class="preprocessor"></span><span class="preprocessor">#define rtdm_close                  rt_dev_close</span>
00448 <span class="preprocessor"></span><span class="preprocessor">#define rtdm_ioctl                  rt_dev_ioctl</span>
00449 <span class="preprocessor"></span><span class="preprocessor">#define rtdm_read                   rt_dev_read</span>
00450 <span class="preprocessor"></span><span class="preprocessor">#define rtdm_write                  rt_dev_write</span>
00451 <span class="preprocessor"></span><span class="preprocessor">#define rtdm_rescmsg                rt_dev_recvmsg</span>
00452 <span class="preprocessor"></span><span class="preprocessor">#define rtdm_recv                   rt_dev_recv</span>
00453 <span class="preprocessor"></span><span class="preprocessor">#define rtdm_recvfrom               rt_dev_recvfrom</span>
00454 <span class="preprocessor"></span><span class="preprocessor">#define rtdm_sendmsg                rt_dev_sendmsg</span>
00455 <span class="preprocessor"></span><span class="preprocessor">#define rtdm_send                   rt_dev_send</span>
00456 <span class="preprocessor"></span><span class="preprocessor">#define rtdm_sendto                 rt_dev_sendto</span>
00457 <span class="preprocessor"></span><span class="preprocessor">#define rtdm_bind                   rt_dev_bind</span>
00458 <span class="preprocessor"></span><span class="preprocessor">#define rtdm_listen                 rt_dev_listen</span>
00459 <span class="preprocessor"></span><span class="preprocessor">#define rtdm_accept                 rt_dev_accept</span>
00460 <span class="preprocessor"></span><span class="preprocessor">#define rtdm_getsockopt             rt_dev_getsockopt</span>
00461 <span class="preprocessor"></span><span class="preprocessor">#define rtdm_setsockopt             rt_dev_setsockopt</span>
00462 <span class="preprocessor"></span><span class="preprocessor">#define rtdm_getsockname            rt_dev_getsockname</span>
00463 <span class="preprocessor"></span><span class="preprocessor">#define rtdm_getpeername            rt_dev_getpeername</span>
00464 <span class="preprocessor"></span><span class="preprocessor">#define rtdm_shutdown               rt_dev_shutdown</span>
00465 <span class="preprocessor"></span>
00466 <span class="keyword">struct </span><a class="code" href="structrtdm__dev__context.html">rtdm_dev_context</a> *<a class="code" href="group__interdrv.html#ga7">rtdm_context_get</a>(<span class="keywordtype">int</span> <a class="code" href="structrtdm__dev__context.html#o1">fd</a>);
00467 
00468 <span class="keyword">static</span> <span class="keyword">inline</span> <span class="keywordtype">void</span> <a class="code" href="group__interdrv.html#ga19">rtdm_context_lock</a>(<span class="keyword">struct</span> <a class="code" href="structrtdm__dev__context.html">rtdm_dev_context</a> *context)
00469 {
00470     atomic_inc(&amp;context-&gt;<a class="code" href="structrtdm__dev__context.html#o2">close_lock_count</a>);
00471 }
00472 
00473 <span class="keyword">static</span> <span class="keyword">inline</span> <span class="keywordtype">void</span> <a class="code" href="group__interdrv.html#ga20">rtdm_context_unlock</a>(<span class="keyword">struct</span> <a class="code" href="structrtdm__dev__context.html">rtdm_dev_context</a> *context)
00474 {
00475     atomic_dec(&amp;context-&gt;<a class="code" href="structrtdm__dev__context.html#o2">close_lock_count</a>);
00476 }
00477 
00478 
00479 <span class="comment">/* --- clock services --- */</span>
00480 <span class="keyword">static</span> <span class="keyword">inline</span> __u64 <a class="code" href="group__clock.html#ga0">rtdm_clock_read</a>(<span class="keywordtype">void</span>)
00481 {
00482     <span class="keywordflow">return</span> xnpod_ticks2ns(<a class="code" href="group__pod.html#ga51">xnpod_get_time</a>());
00483 }
00484 
00485 
00486 <span class="comment">/* --- spin lock services --- */</span>
<a name="l00527"></a><a class="code" href="group__rtdmsync.html#ga20">00527</a> <span class="preprocessor">#define RTDM_EXECUTE_ATOMICALLY(code_block)                                 \</span>
00528 <span class="preprocessor">{                                                                           \</span>
00529 <span class="preprocessor">    spl_t   s;                                                              \</span>
00530 <span class="preprocessor">                                                                            \</span>
00531 <span class="preprocessor">    xnlock_get_irqsave(&amp;nklock, s);                                         \</span>
00532 <span class="preprocessor">    code_block;                                                             \</span>
00533 <span class="preprocessor">    xnlock_put_irqrestore(&amp;nklock, s);                                      \</span>
00534 <span class="preprocessor">}</span>
00535 <span class="preprocessor"></span>
<a name="l00545"></a><a class="code" href="group__rtdmsync.html#ga21">00545</a> <span class="preprocessor">#define RTDM_LOCK_UNLOCKED          SPIN_LOCK_UNLOCKED</span>
00546 <span class="preprocessor"></span>
<a name="l00548"></a><a class="code" href="group__rtdmsync.html#ga0">00548</a> <span class="keyword">typedef</span> spinlock_t                  <a class="code" href="group__rtdmsync.html#ga0">rtdm_lock_t</a>;
00549 
<a name="l00551"></a><a class="code" href="group__rtdmsync.html#ga1">00551</a> <span class="keyword">typedef</span> <span class="keywordtype">unsigned</span> <span class="keywordtype">long</span>               <a class="code" href="group__rtdmsync.html#ga1">rtdm_lockctx_t</a>;
00552 
<a name="l00568"></a><a class="code" href="group__rtdmsync.html#ga22">00568</a> <span class="preprocessor">#define rtdm_lock_init(lock)        spin_lock_init(lock)</span>
00569 <span class="preprocessor"></span>
<a name="l00586"></a><a class="code" href="group__rtdmsync.html#ga23">00586</a> <span class="preprocessor">#define rtdm_lock_get(lock)         rthal_spin_lock(lock)</span>
00587 <span class="preprocessor"></span>
<a name="l00604"></a><a class="code" href="group__rtdmsync.html#ga24">00604</a> <span class="preprocessor">#define rtdm_lock_put(lock)         rthal_spin_unlock(lock)</span>
00605 <span class="preprocessor"></span>
<a name="l00623"></a><a class="code" href="group__rtdmsync.html#ga25">00623</a> <span class="preprocessor">#define rtdm_lock_get_irqsave(lock, context)    \</span>
00624 <span class="preprocessor">    rthal_spin_lock_irqsave(lock, context)</span>
00625 <span class="preprocessor"></span>
<a name="l00643"></a><a class="code" href="group__rtdmsync.html#ga26">00643</a> <span class="preprocessor">#define rtdm_lock_put_irqrestore(lock, context) \</span>
00644 <span class="preprocessor">    rthal_spin_unlock_irqrestore(lock, context)</span>
00645 <span class="preprocessor"></span>
<a name="l00662"></a><a class="code" href="group__rtdmsync.html#ga27">00662</a> <span class="preprocessor">#define rtdm_lock_irqsave(context)              \</span>
00663 <span class="preprocessor">    rthal_local_irq_save(context)</span>
00664 <span class="preprocessor"></span>
<a name="l00681"></a><a class="code" href="group__rtdmsync.html#ga28">00681</a> <span class="preprocessor">#define rtdm_lock_irqrestore(context)           \</span>
00682 <span class="preprocessor">    rthal_local_irq_restore(context)</span>
00683 <span class="preprocessor"></span>
00688 <span class="comment">/* --- Interrupt management services --- */</span>
00694 <span class="keyword">typedef</span> xnintr_t                    rtdm_irq_t;
00695 
<a name="l00703"></a><a class="code" href="group__rtdmirq.html#ga1">00703</a> <span class="keyword">typedef</span> int (*<a class="code" href="group__rtdmirq.html#ga1">rtdm_irq_handler_t</a>)(rtdm_irq_t *irq_handle);
00704 
00705 
<a name="l00712"></a><a class="code" href="group__rtdmirq.html#ga6">00712</a> <span class="preprocessor">#define RTDM_IRQ_PROPAGATE          XN_ISR_CHAINED</span>
00713 <span class="preprocessor"></span>
<a name="l00714"></a><a class="code" href="group__rtdmirq.html#ga7">00714</a> <span class="preprocessor">#define RTDM_IRQ_ENABLE             XN_ISR_ENABLE</span>
00715 <span class="preprocessor"></span>
<a name="l00734"></a><a class="code" href="group__rtdmirq.html#ga8">00734</a> <span class="preprocessor">#define rtdm_irq_get_arg(irq_handle, type)  ((type *)irq_handle-&gt;cookie)</span>
00735 <span class="preprocessor"></span>
00737 <span class="keyword">static</span> <span class="keyword">inline</span> <span class="keywordtype">int</span> <a class="code" href="group__rtdmirq.html#ga2">rtdm_irq_request</a>(rtdm_irq_t *irq_handle,
00738                                    <span class="keywordtype">unsigned</span> <span class="keywordtype">int</span> irq_no,
00739                                    <a class="code" href="group__rtdmirq.html#ga1">rtdm_irq_handler_t</a> handler,
00740                                    <span class="keywordtype">unsigned</span> <span class="keywordtype">long</span> flags,
00741                                    <span class="keyword">const</span> <span class="keywordtype">char</span> *device_name,
00742                                    <span class="keywordtype">void</span> *arg)
00743 {
00744     <a class="code" href="group__intr.html#ga2">xnintr_init</a>(irq_handle, irq_no, handler, NULL, flags);
00745     <span class="keywordflow">return</span> <a class="code" href="group__intr.html#ga4">xnintr_attach</a>(irq_handle, arg);
00746 }
00747 
00748 <span class="keyword">static</span> <span class="keyword">inline</span> <span class="keywordtype">int</span> <a class="code" href="group__rtdmirq.html#ga3">rtdm_irq_free</a>(rtdm_irq_t *irq_handle)
00749 {
00750     <span class="keywordflow">return</span> <a class="code" href="group__intr.html#ga5">xnintr_detach</a>(irq_handle);
00751 }
00752 
00753 <span class="keyword">static</span> <span class="keyword">inline</span> <span class="keywordtype">int</span> <a class="code" href="group__rtdmirq.html#ga4">rtdm_irq_enable</a>(rtdm_irq_t *irq_handle)
00754 {
00755     <span class="keywordflow">return</span> <a class="code" href="group__intr.html#ga6">xnintr_enable</a>(irq_handle);
00756 }
00757 
00758 <span class="keyword">static</span> <span class="keyword">inline</span> <span class="keywordtype">int</span> <a class="code" href="group__rtdmirq.html#ga5">rtdm_irq_disable</a>(rtdm_irq_t *irq_handle)
00759 {
00760     <span class="keywordflow">return</span> <a class="code" href="group__intr.html#ga7">xnintr_disable</a>(irq_handle);
00761 }
00762 
00763 
00764 <span class="comment">/* --- non-real-time signalling services --- */</span>
00765 
00771 <span class="keyword">typedef</span> <span class="keywordtype">unsigned</span>                    rtdm_nrtsig_t;
00772 
<a name="l00782"></a><a class="code" href="group__nrtsignal.html#ga1">00782</a> <span class="keyword">typedef</span> void (*<a class="code" href="group__nrtsignal.html#ga1">rtdm_nrtsig_handler_t</a>)(rtdm_nrtsig_t nrt_sig);
00786 <span class="keyword">static</span> <span class="keyword">inline</span> <span class="keywordtype">int</span> <a class="code" href="group__nrtsignal.html#ga2">rtdm_nrtsig_init</a>(rtdm_nrtsig_t *nrt_sig,
00787                                    <a class="code" href="group__nrtsignal.html#ga1">rtdm_nrtsig_handler_t</a> handler)
00788 {
00789     *nrt_sig = rthal_alloc_virq();
00790 
00791     <span class="keywordflow">if</span> (*nrt_sig == 0)
00792         <span class="keywordflow">return</span> -EAGAIN;
00793 
00794     rthal_virtualize_irq(rthal_root_domain, *nrt_sig, handler, NULL,
00795                          IPIPE_HANDLE_MASK);
00796     <span class="keywordflow">return</span> 0;
00797 }
00798 
00799 <span class="keyword">static</span> <span class="keyword">inline</span> <span class="keywordtype">void</span> <a class="code" href="group__nrtsignal.html#ga3">rtdm_nrtsig_destroy</a>(rtdm_nrtsig_t *nrt_sig)
00800 {
00801     rthal_free_virq(*nrt_sig);
00802 }
00803 
00804 <span class="keyword">static</span> <span class="keyword">inline</span> <span class="keywordtype">void</span> <a class="code" href="group__nrtsignal.html#ga4">rtdm_nrtsig_pend</a>(rtdm_nrtsig_t *nrt_sig)
00805 {
00806     rthal_trigger_irq(*nrt_sig);
00807 }
00808 
00809 
00810 <span class="comment">/* --- task and timing services --- */</span>
00816 <span class="keyword">typedef</span> xnthread_t                  rtdm_task_t;
00817 
<a name="l00823"></a><a class="code" href="group__rtdmtask.html#ga1">00823</a> <span class="keyword">typedef</span> void (*<a class="code" href="group__rtdmtask.html#ga1">rtdm_task_proc_t</a>)(<span class="keywordtype">void</span> *arg);
00824 
00825 
00830 <span class="preprocessor">#define RTDM_TASK_LOWEST_PRIORITY   XNCORE_LOW_PRIO</span>
00831 <span class="preprocessor"></span><span class="preprocessor">#define RTDM_TASK_HIGHEST_PRIORITY  XNCORE_HIGH_PRIO</span>
00832 <span class="preprocessor"></span>
00838 <span class="preprocessor">#define RTDM_TASK_RAISE_PRIORITY    (+1)</span>
00839 <span class="preprocessor"></span><span class="preprocessor">#define RTDM_TASK_LOWER_PRIORITY    (-1)</span>
00840 <span class="preprocessor"></span>
00844 <span class="keyword">static</span> <span class="keyword">inline</span> <span class="keywordtype">int</span> <a class="code" href="group__rtdmtask.html#ga2">rtdm_task_init</a>(rtdm_task_t *task, <span class="keyword">const</span> <span class="keywordtype">char</span> *name,
00845                                  <a class="code" href="group__rtdmtask.html#ga1">rtdm_task_proc_t</a> task_proc, <span class="keywordtype">void</span> *arg,
00846                                  <span class="keywordtype">int</span> priority, __u64 period)
00847 {
00848     <span class="keywordtype">int</span> res;
00849 
00850     res = <a class="code" href="group__pod.html#ga28">xnpod_init_thread</a>(task, name, priority, 0, 0);
00851     <span class="keywordflow">if</span> (res)
00852         <span class="keywordflow">goto</span> done;
00853 
00854     <span class="keywordflow">if</span> (!__builtin_constant_p(period) || (period != XN_INFINITE)) {
00855         res = <a class="code" href="group__pod.html#ga49">xnpod_set_thread_periodic</a>(task, XN_INFINITE,
00856                                         xnpod_ns2ticks(period));
00857         <span class="keywordflow">if</span> (res)
00858             <span class="keywordflow">goto</span> done;
00859     }
00860 
00861     res = <a class="code" href="group__pod.html#ga29">xnpod_start_thread</a>(task, 0, 0, XNPOD_ALL_CPUS, task_proc, arg);
00862 
00863   done:
00864     <span class="keywordflow">return</span> res;
00865 }
00866 
00867 <span class="keyword">static</span> <span class="keyword">inline</span> <span class="keywordtype">void</span> <a class="code" href="group__rtdmtask.html#ga3">rtdm_task_destroy</a>(rtdm_task_t *task)
00868 {
00869     <a class="code" href="group__pod.html#ga31">xnpod_delete_thread</a>(task);
00870 }
00871 
00872 <span class="keywordtype">void</span> <a class="code" href="group__rtdmtask.html#ga9">rtdm_task_join_nrt</a>(rtdm_task_t *task, <span class="keywordtype">unsigned</span> <span class="keywordtype">int</span> poll_delay);
00873 
00874 <span class="keyword">static</span> <span class="keyword">inline</span> <span class="keywordtype">void</span> <a class="code" href="group__rtdmtask.html#ga4">rtdm_task_set_priority</a>(rtdm_task_t *task, <span class="keywordtype">int</span> priority)
00875 {
00876     <a class="code" href="group__pod.html#ga36">xnpod_renice_thread</a>(task, priority);
00877     <a class="code" href="group__pod.html#ga39">xnpod_schedule</a>();
00878 }
00879 
00880 <span class="keyword">static</span> <span class="keyword">inline</span> <span class="keywordtype">int</span> <a class="code" href="group__rtdmtask.html#ga5">rtdm_task_set_period</a>(rtdm_task_t *task, __u64 period)
00881 {
00882     <span class="keywordflow">return</span> <a class="code" href="group__pod.html#ga49">xnpod_set_thread_periodic</a>(task, XN_INFINITE,
00883                                      xnpod_ns2ticks(period));
00884 }
00885 
00886 <span class="keyword">static</span> <span class="keyword">inline</span> <span class="keywordtype">int</span> <a class="code" href="group__rtdmtask.html#ga7">rtdm_task_unblock</a>(rtdm_task_t *task)
00887 {
00888     <span class="keywordtype">int</span> res = <a class="code" href="group__pod.html#ga35">xnpod_unblock_thread</a>(task);
00889 
00890     <a class="code" href="group__pod.html#ga39">xnpod_schedule</a>();
00891     <span class="keywordflow">return</span> res;
00892 }
00893 
00894 <span class="keyword">static</span> <span class="keyword">inline</span> rtdm_task_t *<a class="code" href="group__rtdmtask.html#ga8">rtdm_task_current</a>(<span class="keywordtype">void</span>)
00895 {
00896     <span class="keywordflow">return</span> xnpod_current_thread();
00897 }
00898 
00899 <span class="keyword">static</span> <span class="keyword">inline</span> <span class="keywordtype">int</span> <a class="code" href="group__rtdmtask.html#ga6">rtdm_task_wait_period</a>(<span class="keywordtype">void</span>)
00900 {
00901     <span class="keywordflow">return</span> <a class="code" href="group__pod.html#ga50">xnpod_wait_thread_period</a>();
00902 }
00903 
00904 <span class="keywordtype">int</span> <a class="code" href="group__rtdmtask.html#ga10">rtdm_task_sleep</a>(__u64 delay);
00905 <span class="keywordtype">int</span> <a class="code" href="group__rtdmtask.html#ga11">rtdm_task_sleep_until</a>(__u64 wakeup_time);
00906 <span class="keywordtype">void</span> <a class="code" href="group__rtdmtask.html#ga12">rtdm_task_busy_sleep</a>(__u64 delay);
00907 
00908 
00909 <span class="comment">/* --- timeout sequences */</span>
00910 
00911 <span class="keyword">typedef</span> __u64                       rtdm_toseq_t;
00912 
00913 <span class="keyword">static</span> <span class="keyword">inline</span> <span class="keywordtype">void</span> <a class="code" href="group__rtdmsync.html#ga2">rtdm_toseq_init</a>(rtdm_toseq_t *timeout_seq, __s64 timeout)
00914 {
00915     *timeout_seq = <a class="code" href="group__pod.html#ga51">xnpod_get_time</a>() + xnpod_ns2ticks(timeout);
00916 }
00917 
00918 
00919 <span class="comment">/* --- event services --- */</span>
00920 
00921 <span class="keyword">typedef</span> <span class="keyword">struct </span>{
00922     <span class="keywordtype">unsigned</span> <span class="keywordtype">long</span>                   pending;
00923     xnsynch_t                       synch_base;
00924 } rtdm_event_t;
00925 
00926 <span class="keyword">static</span> <span class="keyword">inline</span> <span class="keywordtype">void</span> <a class="code" href="group__rtdmsync.html#ga3">rtdm_event_init</a>(rtdm_event_t *event, <span class="keywordtype">unsigned</span> <span class="keywordtype">long</span> pending)
00927 {
00928     event-&gt;pending = pending;
00929     <a class="code" href="group__synch.html#ga0">xnsynch_init</a>(&amp;event-&gt;synch_base, XNSYNCH_PRIO);
00930 }
00931 
00932 <span class="keywordtype">void</span> _rtdm_synch_flush(xnsynch_t *synch, <span class="keywordtype">unsigned</span> <span class="keywordtype">long</span> reason);
00933 
00934 <span class="keyword">static</span> <span class="keyword">inline</span> <span class="keywordtype">void</span> <a class="code" href="group__rtdmsync.html#ga4">rtdm_event_destroy</a>(rtdm_event_t *event)
00935 {
00936     _rtdm_synch_flush(&amp;event-&gt;synch_base, XNRMID);
00937 }
00938 
00939 <span class="keywordtype">int</span> <a class="code" href="group__rtdmsync.html#ga8">rtdm_event_wait</a>(rtdm_event_t *event);
00940 <span class="keywordtype">int</span> <a class="code" href="group__rtdmsync.html#ga9">rtdm_event_timedwait</a>(rtdm_event_t *event, __s64 timeout,
00941                          rtdm_toseq_t *timeout_seq);
00942 <span class="keywordtype">void</span> <a class="code" href="group__rtdmsync.html#ga7">rtdm_event_signal</a>(rtdm_event_t *event);
00943 
00944 <span class="keyword">static</span> <span class="keyword">inline</span> <span class="keywordtype">void</span> <a class="code" href="group__rtdmsync.html#ga5">rtdm_event_pulse</a>(rtdm_event_t *event)
00945 {
00946     _rtdm_synch_flush(&amp;event-&gt;synch_base, 0);
00947 }
00948 
00949 <span class="keyword">static</span> <span class="keyword">inline</span> <span class="keywordtype">void</span> <a class="code" href="group__rtdmsync.html#ga6">rtdm_event_clear</a>(rtdm_event_t *event)
00950 {
00951     event-&gt;pending = 0;
00952 }
00953 
00954 
00955 <span class="comment">/* --- semaphore services --- */</span>
00956 
00957 <span class="keyword">typedef</span> <span class="keyword">struct </span>{
00958     <span class="keywordtype">unsigned</span> <span class="keywordtype">long</span>                   value;
00959     xnsynch_t                       synch_base;
00960 } rtdm_sem_t;
00961 
00962 <span class="keyword">static</span> <span class="keyword">inline</span> <span class="keywordtype">void</span> <a class="code" href="group__rtdmsync.html#ga10">rtdm_sem_init</a>(rtdm_sem_t *sem, <span class="keywordtype">unsigned</span> <span class="keywordtype">long</span> value)
00963 {
00964     sem-&gt;value = value;
00965     <a class="code" href="group__synch.html#ga0">xnsynch_init</a>(&amp;sem-&gt;synch_base, XNSYNCH_PRIO);
00966 }
00967 
00968 <span class="keyword">static</span> <span class="keyword">inline</span> <span class="keywordtype">void</span> <a class="code" href="group__rtdmsync.html#ga11">rtdm_sem_destroy</a>(rtdm_sem_t *sem)
00969 {
00970     _rtdm_synch_flush(&amp;sem-&gt;synch_base, XNRMID);
00971 }
00972 
00973 <span class="keywordtype">int</span> <a class="code" href="group__rtdmsync.html#ga12">rtdm_sem_down</a>(rtdm_sem_t *sem);
00974 <span class="keywordtype">int</span> <a class="code" href="group__rtdmsync.html#ga13">rtdm_sem_timeddown</a>(rtdm_sem_t *sem, __s64 timeout,
00975                        rtdm_toseq_t *timeout_seq);
00976 <span class="keywordtype">void</span> <a class="code" href="group__rtdmsync.html#ga14">rtdm_sem_up</a>(rtdm_sem_t *sem);
00977 
00978 
00979 <span class="comment">/* --- mutex services --- */</span>
00980 
00981 <span class="keyword">typedef</span> <span class="keyword">struct </span>{
00982     <span class="keywordtype">unsigned</span> <span class="keywordtype">long</span>                   locked;
00983     xnsynch_t                       synch_base;
00984 } rtdm_mutex_t;
00985 
00986 <span class="keyword">static</span> <span class="keyword">inline</span> <span class="keywordtype">void</span> <a class="code" href="group__rtdmsync.html#ga15">rtdm_mutex_init</a>(rtdm_mutex_t *mutex)
00987 {
00988     mutex-&gt;locked = 0;
00989     <a class="code" href="group__synch.html#ga0">xnsynch_init</a>(&amp;mutex-&gt;synch_base, XNSYNCH_PRIO|XNSYNCH_PIP);
00990 }
00991 
00992 <span class="keyword">static</span> <span class="keyword">inline</span> <span class="keywordtype">void</span> <a class="code" href="group__rtdmsync.html#ga16">rtdm_mutex_destroy</a>(rtdm_mutex_t *mutex)
00993 {
00994     _rtdm_synch_flush(&amp;mutex-&gt;synch_base, XNRMID);
00995 }
00996 
00997 <span class="keywordtype">int</span> <a class="code" href="group__rtdmsync.html#ga17">rtdm_mutex_lock</a>(rtdm_mutex_t *mutex);
00998 <span class="keywordtype">int</span> <a class="code" href="group__rtdmsync.html#ga18">rtdm_mutex_timedlock</a>(rtdm_mutex_t *mutex, __s64 timeout,
00999                          rtdm_toseq_t *timeout_seq);
01000 <span class="keywordtype">void</span> <a class="code" href="group__rtdmsync.html#ga19">rtdm_mutex_unlock</a>(rtdm_mutex_t *mutex);
01001 
01002 
01003 <span class="comment">/* --- utility functions --- */</span>
01004 
01005 <span class="preprocessor">#define rtdm_printk(format, ...)    printk(format, ##__VA_ARGS__)</span>
01006 <span class="preprocessor"></span>
01007 <span class="keyword">static</span> <span class="keyword">inline</span> <span class="keywordtype">void</span> *<a class="code" href="group__util.html#ga1">rtdm_malloc</a>(size_t size)
01008 {
01009     <span class="keywordflow">return</span> xnmalloc(size);
01010 }
01011 
01012 <span class="keyword">static</span> <span class="keyword">inline</span> <span class="keywordtype">void</span> <a class="code" href="group__util.html#ga2">rtdm_free</a>(<span class="keywordtype">void</span> *ptr)
01013 {
01014     xnfree(ptr);
01015 }
01016 
01017 <span class="keyword">static</span> <span class="keyword">inline</span> <span class="keywordtype">int</span> <a class="code" href="group__util.html#ga3">rtdm_read_user_ok</a>(rtdm_user_info_t *user_info,
01018                                     <span class="keyword">const</span> <span class="keywordtype">void</span> __user *ptr, size_t size)
01019 {
01020     <span class="keywordflow">return</span> __xn_access_ok(user_info, VERIFY_READ, ptr, size);
01021 }
01022 
01023 <span class="keyword">static</span> <span class="keyword">inline</span> <span class="keywordtype">int</span> <a class="code" href="group__util.html#ga4">rtdm_rw_user_ok</a>(rtdm_user_info_t *user_info,
01024                                   <span class="keyword">const</span> <span class="keywordtype">void</span> __user *ptr, size_t size)
01025 {
01026     <span class="keywordflow">return</span> __xn_access_ok(user_info, VERIFY_WRITE, ptr, size);
01027 }
01028 
01029 <span class="keyword">static</span> <span class="keyword">inline</span> <span class="keywordtype">int</span> <a class="code" href="group__util.html#ga5">rtdm_copy_from_user</a>(rtdm_user_info_t *user_info,
01030                                       <span class="keywordtype">void</span> *dst, <span class="keyword">const</span> <span class="keywordtype">void</span> __user *src,
01031                                       size_t size)
01032 {
01033     <span class="keywordflow">return</span> __xn_copy_from_user(user_info, dst, src, size);
01034 }
01035 
01036 <span class="keyword">static</span> <span class="keyword">inline</span> <span class="keywordtype">int</span> <a class="code" href="group__util.html#ga6">rtdm_copy_to_user</a>(rtdm_user_info_t *user_info,
01037                                     <span class="keywordtype">void</span> __user *dst, <span class="keyword">const</span> <span class="keywordtype">void</span> *src,
01038                                     size_t size)
01039 {
01040     <span class="keywordflow">return</span> __xn_copy_to_user(user_info, dst, src, size);
01041 }
01042 
01043 <span class="keyword">static</span> <span class="keyword">inline</span> <span class="keywordtype">int</span> <a class="code" href="group__util.html#ga7">rtdm_strncpy_from_user</a>(rtdm_user_info_t *user_info,
01044                                          <span class="keywordtype">char</span> *dst,
01045                                          <span class="keyword">const</span> <span class="keywordtype">char</span> __user *src,
01046                                          size_t count)
01047 {
01048     <span class="keywordflow">if</span> (unlikely(__xn_access_ok(user_info, VERIFY_READ, src, 1)))
01049         <span class="keywordflow">return</span> -EFAULT;
01050     <span class="keywordflow">return</span> __xn_strncpy_from_user(user_info, dst, src, count);
01051 }
01052 
01053 <span class="keyword">static</span> <span class="keyword">inline</span> <span class="keywordtype">int</span> <a class="code" href="group__util.html#ga8">rtdm_in_rt_context</a>(<span class="keywordtype">void</span>)
01054 {
01055     <span class="keywordflow">return</span> (rthal_current_domain != rthal_root_domain);
01056 }
01057 
01058 <span class="keywordtype">int</span> rtdm_exec_in_rt(<span class="keyword">struct</span> <a class="code" href="structrtdm__dev__context.html">rtdm_dev_context</a> *context,
01059                     rtdm_user_info_t *user_info, <span class="keywordtype">void</span> *arg,
01060                     rtdm_rt_handler_t handler);
01061 
01062 <span class="preprocessor">#endif </span><span class="comment">/* _RTDM_DRIVER_H */</span>
</pre></div><hr size="1"><address style="align: right;"><small>Generated on Tue Nov 1 23:34:15 2005 for Xenomai API by&nbsp;
<a href="http://www.doxygen.org/index.html">
<img src="doxygen.png" alt="doxygen" align="middle" border="0"></a> 1.4.2 </small></address>
</body>
</html>
