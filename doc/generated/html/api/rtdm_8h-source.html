<!DOCTYPE HTML PUBLIC "-//W3C//DTD HTML 4.01 Transitional//EN">
<html><head><meta http-equiv="Content-Type" content="text/html;charset=iso-8859-1">
<title>Xenomai API: include/rtdm/rtdm.h Source File</title>
<link href="doxygen.css" rel="stylesheet" type="text/css">
</head><body>
<!-- Generated by Doxygen 1.4.2 -->
<div class="qindex">  <form class="search" action="search.php" method="get">
<a class="qindex" href="main.html">Main&nbsp;Page</a> | <a class="qindex" href="modules.html">Modules</a> | <a class="qindex" href="annotated.html">Data&nbsp;Structures</a> | <a class="qindex" href="dirs.html">Directories</a> | <a class="qindex" href="files.html">File&nbsp;List</a> | <a class="qindex" href="functions.html">Data&nbsp;Fields</a> | <a class="qindex" href="globals.html">Globals</a>  | <span class="search"><u>S</u>earch&nbsp;for&nbsp;<input class="search" type="text" name="query" value="" size="20" accesskey="s"/></span></form></div>
<div class="nav">
<a class="el" href="dir_000000.html">include</a>&nbsp;/&nbsp;<a class="el" href="dir_000005.html">rtdm</a></div>
<h1>rtdm.h</h1><a href="rtdm_8h.html">Go to the documentation of this file.</a><div class="fragment"><pre class="fragment">00001 
00035 <span class="preprocessor">#ifndef _RTDM_H</span>
00036 <span class="preprocessor"></span><span class="preprocessor">#define _RTDM_H</span>
00037 <span class="preprocessor"></span>
00038 <span class="preprocessor">#ifdef __KERNEL__</span>
00039 <span class="preprocessor"></span>
00040 <span class="preprocessor">#include &lt;linux/fcntl.h&gt;</span>
00041 <span class="preprocessor">#include &lt;linux/ioctl.h&gt;</span>
00042 <span class="preprocessor">#include &lt;linux/sched.h&gt;</span>
00043 <span class="preprocessor">#include &lt;linux/socket.h&gt;</span>
00044 
00045 <span class="keyword">typedef</span> size_t                      socklen_t;
00046 <span class="keyword">typedef</span> <span class="keyword">struct </span>task_struct          rtdm_user_info_t;
00047 
00048 <span class="preprocessor">#else  </span><span class="comment">/* !__KERNEL__ */</span>
00049 
00050 <span class="preprocessor">#include &lt;fcntl.h&gt;</span>
00051 <span class="preprocessor">#include &lt;inttypes.h&gt;</span>
00052 <span class="preprocessor">#include &lt;sys/ioctl.h&gt;</span>
00053 <span class="preprocessor">#include &lt;sys/socket.h&gt;</span>
00054 
00055 <span class="preprocessor">#endif </span><span class="comment">/* !__KERNEL__ */</span>
00056 
00057 
<a name="l00059"></a><a class="code" href="rtdm_8h.html#a0">00059</a> <span class="preprocessor">#define RTDM_MAX_DEVNAME_LEN        31</span>
00060 <span class="preprocessor"></span>
00061 
00066 <span class="preprocessor">#define RTDM_CLASS_PARPORT          1</span>
00067 <span class="preprocessor"></span><span class="preprocessor">#define RTDM_CLASS_SERIAL           2</span>
00068 <span class="preprocessor"></span><span class="preprocessor">#define RTDM_CLASS_CAN              3</span>
00069 <span class="preprocessor"></span><span class="preprocessor">#define RTDM_CLASS_NETWORK          4</span>
00070 <span class="preprocessor"></span><span class="preprocessor">#define RTDM_CLASS_RTMAC            5</span>
00071 <span class="preprocessor"></span><span class="preprocessor">#define RTDM_CLASS_BENCHMARK        6</span>
00072 <span class="preprocessor"></span><span class="comment">/*</span>
00073 <span class="comment">#define RTDM_CLASS_USB              ?</span>
00074 <span class="comment">#define RTDM_CLASS_FIREWIRE         ?</span>
00075 <span class="comment">#define RTDM_CLASS_INTERBUS         ?</span>
00076 <span class="comment">#define RTDM_CLASS_PROFIBUS         ?</span>
00077 <span class="comment">#define ...</span>
00078 <span class="comment">*/</span>
00079 <span class="preprocessor">#define RTDM_CLASS_EXPERIMENTAL     224</span>
00080 <span class="preprocessor"></span><span class="preprocessor">#define RTDM_CLASS_MAX              255</span>
00081 <span class="preprocessor"></span>
00084 <span class="preprocessor">#define RTIOC_TYPE_COMMON           0</span>
00085 <span class="preprocessor"></span>
00086 
<a name="l00096"></a><a class="code" href="rtdm_8h.html#a10">00096</a> <span class="preprocessor">#define RTIOC_PURGE                 _IOW(RTIOC_TYPE_COMMON, 0x10, int)</span>
00097 <span class="preprocessor"></span>
00103 <span class="preprocessor">#define RTDM_PURGE_RX_BUFFER        0x0001</span>
00104 <span class="preprocessor"></span><span class="preprocessor">#define RTDM_PURGE_TX_BUFFER        0x0002</span>
00105 <span class="preprocessor"></span>
00108 <span class="comment">/* Internally used for mapping socket functions on IOCTLs */</span>
00109 <span class="keyword">struct </span>_rtdm_getsockopt_args {
00110     <span class="keywordtype">int</span>                             level;
00111     <span class="keywordtype">int</span>                             optname;
00112     <span class="keywordtype">void</span>                            *optval;
00113     socklen_t                       *optlen;
00114 };
00115 
00116 <span class="keyword">struct </span>_rtdm_setsockopt_args {
00117     <span class="keywordtype">int</span>                             level;
00118     <span class="keywordtype">int</span>                             optname;
00119     <span class="keyword">const</span> <span class="keywordtype">void</span>                      *optval;
00120     socklen_t                       optlen;
00121 };
00122 
00123 <span class="keyword">struct </span>_rtdm_getsockaddr_args {
00124     <span class="keyword">struct </span>sockaddr                 *addr;
00125     socklen_t                       *addrlen;
00126 };
00127 
00128 <span class="keyword">struct </span>_rtdm_setsockaddr_args {
00129     <span class="keyword">const</span> <span class="keyword">struct </span>sockaddr           *addr;
00130     socklen_t                       addrlen;
00131 };
00132 
00133 <span class="preprocessor">#define _RTIOC_GETSOCKOPT          _IOW(RTIOC_TYPE_COMMON, 0x20,        \</span>
00134 <span class="preprocessor">                                        struct _rtdm_getsockopt_args)</span>
00135 <span class="preprocessor"></span><span class="preprocessor">#define _RTIOC_SETSOCKOPT          _IOW(RTIOC_TYPE_COMMON, 0x21,        \</span>
00136 <span class="preprocessor">                                        struct _rtdm_setsockopt_args)</span>
00137 <span class="preprocessor"></span><span class="preprocessor">#define _RTIOC_BIND                _IOW(RTIOC_TYPE_COMMON, 0x22,        \</span>
00138 <span class="preprocessor">                                        struct _rtdm_setsockaddr_args)</span>
00139 <span class="preprocessor"></span><span class="preprocessor">#define _RTIOC_CONNECT             _IOW(RTIOC_TYPE_COMMON, 0x23,        \</span>
00140 <span class="preprocessor">                                        struct _rtdm_setsockaddr_args)</span>
00141 <span class="preprocessor"></span><span class="preprocessor">#define _RTIOC_LISTEN              _IOW(RTIOC_TYPE_COMMON, 0x24,        \</span>
00142 <span class="preprocessor">                                        int)</span>
00143 <span class="preprocessor"></span><span class="preprocessor">#define _RTIOC_ACCEPT              _IOW(RTIOC_TYPE_COMMON, 0x25,        \</span>
00144 <span class="preprocessor">                                        struct _rtdm_getsockaddr_args)</span>
00145 <span class="preprocessor"></span><span class="preprocessor">#define _RTIOC_GETSOCKNAME         _IOW(RTIOC_TYPE_COMMON, 0x26,        \</span>
00146 <span class="preprocessor">                                        struct _rtdm_getsockaddr_args)</span>
00147 <span class="preprocessor"></span><span class="preprocessor">#define _RTIOC_GETPEERNAME         _IOW(RTIOC_TYPE_COMMON, 0x27,        \</span>
00148 <span class="preprocessor">                                        struct _rtdm_getsockaddr_args)</span>
00149 <span class="preprocessor"></span><span class="preprocessor">#define _RTIOC_SHUTDOWN            _IOW(RTIOC_TYPE_COMMON, 0x28,        \</span>
00150 <span class="preprocessor">                                        int)</span>
00151 <span class="preprocessor"></span>
00152 
00153 <span class="preprocessor">#ifdef __KERNEL__</span>
00154 <span class="preprocessor"></span><span class="keywordtype">int</span>     _rtdm_open   (rtdm_user_info_t *user_info, <span class="keyword">const</span> <span class="keywordtype">char</span> *path,
00155                       <span class="keywordtype">int</span> oflag);
00156 <span class="keywordtype">int</span>     _rtdm_socket (rtdm_user_info_t *user_info, <span class="keywordtype">int</span> protocol_family,
00157                       <span class="keywordtype">int</span> socket_type, <span class="keywordtype">int</span> protocol);
00158 <span class="keywordtype">int</span>     _rtdm_close  (rtdm_user_info_t *user_info, <span class="keywordtype">int</span> fd, <span class="keywordtype">int</span> forced);
00159 <span class="keywordtype">int</span>     _rtdm_ioctl  (rtdm_user_info_t *user_info, <span class="keywordtype">int</span> fd, <span class="keywordtype">int</span> request, ...);
00160 ssize_t _rtdm_read   (rtdm_user_info_t *user_info, <span class="keywordtype">int</span> fd, <span class="keywordtype">void</span> *buf,
00161                       size_t nbyte);
00162 ssize_t _rtdm_write  (rtdm_user_info_t *user_info, <span class="keywordtype">int</span> fd, <span class="keyword">const</span> <span class="keywordtype">void</span> *buf,
00163                       size_t nbyte);
00164 ssize_t _rtdm_recvmsg(rtdm_user_info_t *user_info, <span class="keywordtype">int</span> fd, <span class="keyword">struct</span> msghdr *msg,
00165                       <span class="keywordtype">int</span> flags);
00166 ssize_t _rtdm_sendmsg(rtdm_user_info_t *user_info, <span class="keywordtype">int</span> fd,
00167                       <span class="keyword">const</span> <span class="keyword">struct</span> msghdr *msg, <span class="keywordtype">int</span> flags);
00168 <span class="preprocessor">#endif </span><span class="comment">/* __KERNEL__ */</span>
00169 
00170 
00171 <span class="comment">/* Define RTDM_NO_DEFAULT_USER_API to switch off the default rt_dev_xxx</span>
00172 <span class="comment"> * interface when providing a customised user API */</span>
00173 <span class="preprocessor">#ifndef RTDM_NO_DEFAULT_USER_API</span>
00174 <span class="preprocessor"></span>
00175 <span class="preprocessor">#ifdef __KERNEL__</span>
00176 <span class="preprocessor"></span>
00177 <span class="preprocessor">#define rt_dev_open(path, oflag, ...)                           \</span>
00178 <span class="preprocessor">    _rtdm_open(NULL, path, oflag)</span>
00179 <span class="preprocessor"></span>
00180 <span class="preprocessor">#define rt_dev_socket(protocol_family, socket_type, protocol)   \</span>
00181 <span class="preprocessor">    _rtdm_socket(NULL, protocol_family, socket_type, protocol)</span>
00182 <span class="preprocessor"></span>
00183 <span class="preprocessor">#define rt_dev_close(fd)                                        \</span>
00184 <span class="preprocessor">    _rtdm_close(NULL, fd, 0)</span>
00185 <span class="preprocessor"></span>
00186 <span class="preprocessor">#define rt_dev_ioctl(fd, request, ...)                          \</span>
00187 <span class="preprocessor">    _rtdm_ioctl(NULL, fd, request, __VA_ARGS__)</span>
00188 <span class="preprocessor"></span>
00189 <span class="preprocessor">#define rt_dev_read(fd, buf, nbyte)                             \</span>
00190 <span class="preprocessor">    _rtdm_read(NULL, fd, buf, nbyte)</span>
00191 <span class="preprocessor"></span>
00192 <span class="preprocessor">#define rt_dev_write(fd, buf, nbyte)                            \</span>
00193 <span class="preprocessor">    _rtdm_write(NULL, fd, buf, nbyte)</span>
00194 <span class="preprocessor"></span>
00195 <span class="preprocessor">#define rt_dev_recvmsg(fd, msg, flags)                          \</span>
00196 <span class="preprocessor">    _rtdm_recvmsg(NULL, fd, msg, flags)</span>
00197 <span class="preprocessor"></span>
00198 <span class="preprocessor">#define rt_dev_sendmsg(fd, msg, flags)                          \</span>
00199 <span class="preprocessor">    _rtdm_sendmsg(NULL, fd, msg, flags)</span>
00200 <span class="preprocessor"></span>
00201 
00202 <span class="keyword">static</span> <span class="keyword">inline</span> ssize_t rt_dev_recvfrom(<span class="keywordtype">int</span> fd, <span class="keywordtype">void</span> *buf, size_t len, <span class="keywordtype">int</span> flags,
00203                                       <span class="keyword">struct</span> sockaddr *from,
00204                                       socklen_t *fromlen)
00205 {
00206     <span class="keyword">struct </span>iovec    iov = {buf, len};
00207     <span class="keyword">struct </span>msghdr   msg =
00208         {from, (from != NULL) ? *fromlen : 0, &amp;iov, 1, NULL, 0};
00209     <span class="keywordtype">int</span>             ret;
00210 
00211     ret = rt_dev_recvmsg(fd, &amp;msg, flags);
00212     <span class="keywordflow">if</span> ((ret &gt;= 0) &amp;&amp; (from != NULL))
00213         *fromlen = msg.msg_namelen;
00214     <span class="keywordflow">return</span> ret;
00215 }
00216 
00217 <span class="preprocessor">#else  </span><span class="comment">/* !__KERNEL__ */</span>
00218 
00219 <span class="preprocessor">#ifdef __cplusplus</span>
00220 <span class="preprocessor"></span><span class="keyword">extern</span> <span class="stringliteral">"C"</span> {
00221 <span class="preprocessor">#endif</span>
00222 <span class="preprocessor"></span>
00223 <span class="keywordtype">int</span>     rt_dev_open   (<span class="keyword">const</span> <span class="keywordtype">char</span> *path, <span class="keywordtype">int</span> oflag, ...);
00224 <span class="keywordtype">int</span>     rt_dev_socket (<span class="keywordtype">int</span> protocol_family, <span class="keywordtype">int</span> socket_type, <span class="keywordtype">int</span> protocol);
00225 <span class="keywordtype">int</span>     rt_dev_close  (<span class="keywordtype">int</span> fd);
00226 <span class="keywordtype">int</span>     rt_dev_ioctl  (<span class="keywordtype">int</span> fd, <span class="keywordtype">int</span> request, ...);
00227 ssize_t rt_dev_read   (<span class="keywordtype">int</span> fd, <span class="keywordtype">void</span> *buf, size_t nbyte);
00228 ssize_t rt_dev_write  (<span class="keywordtype">int</span> fd, <span class="keyword">const</span> <span class="keywordtype">void</span> *buf, size_t nbyte);
00229 ssize_t rt_dev_recvmsg(<span class="keywordtype">int</span> fd, <span class="keyword">struct</span> msghdr *msg, <span class="keywordtype">int</span> flags);
00230 ssize_t rt_dev_sendmsg(<span class="keywordtype">int</span> fd, <span class="keyword">const</span> <span class="keyword">struct</span> msghdr *msg, <span class="keywordtype">int</span> flags);
00231 
00232 ssize_t rt_dev_recvfrom(<span class="keywordtype">int</span> fd, <span class="keywordtype">void</span> *buf, size_t len, <span class="keywordtype">int</span> flags,
00233                         <span class="keyword">struct</span> sockaddr *from,
00234                         socklen_t *fromlen);
00235 
00236 <span class="preprocessor">#ifdef __cplusplus</span>
00237 <span class="preprocessor"></span>}
00238 <span class="preprocessor">#endif</span>
00239 <span class="preprocessor"></span>
00240 <span class="preprocessor">#endif </span><span class="comment">/* __KERNEL__ */</span>
00241 
00242 <span class="preprocessor">#ifdef __cplusplus</span>
00243 <span class="preprocessor"></span><span class="keyword">extern</span> <span class="stringliteral">"C"</span> {
00244 <span class="preprocessor">#endif</span>
00245 <span class="preprocessor"></span>
00246 <span class="keyword">static</span> <span class="keyword">inline</span> ssize_t rt_dev_recv(<span class="keywordtype">int</span> fd, <span class="keywordtype">void</span> *buf, size_t len, <span class="keywordtype">int</span> flags)
00247 {
00248     <span class="keywordflow">return</span> rt_dev_recvfrom(fd, buf, len, flags, NULL, NULL);
00249 }
00250 
00251 
00252 <span class="keyword">static</span> <span class="keyword">inline</span> ssize_t rt_dev_sendto(<span class="keywordtype">int</span> fd, <span class="keyword">const</span> <span class="keywordtype">void</span> *buf, size_t len,
00253                                     <span class="keywordtype">int</span> flags, <span class="keyword">const</span> <span class="keyword">struct</span> sockaddr *to,
00254                                     socklen_t tolen)
00255 {
00256     <span class="keyword">struct </span>iovec    iov = {(<span class="keywordtype">void</span> *)buf, len};
00257     <span class="keyword">struct </span>msghdr   msg =
00258         {(<span class="keyword">struct </span>sockaddr *)to, tolen, &amp;iov, 1, NULL, 0};
00259 
00260     <span class="keywordflow">return</span> rt_dev_sendmsg(fd, &amp;msg, flags);
00261 }
00262 
00263 
00264 <span class="keyword">static</span> <span class="keyword">inline</span> ssize_t rt_dev_send(<span class="keywordtype">int</span> fd, <span class="keyword">const</span> <span class="keywordtype">void</span> *buf, size_t len,
00265                                   <span class="keywordtype">int</span> flags)
00266 {
00267     <span class="keywordflow">return</span> rt_dev_sendto(fd, buf, len, flags, NULL, 0);
00268 }
00269 
00270 
00271 <span class="keyword">static</span> <span class="keyword">inline</span> <span class="keywordtype">int</span> rt_dev_getsockopt(<span class="keywordtype">int</span> fd, <span class="keywordtype">int</span> level, <span class="keywordtype">int</span> optname,
00272                                     <span class="keywordtype">void</span> *optval, socklen_t *optlen)
00273 {
00274     <span class="keyword">struct </span>_rtdm_getsockopt_args args = {level, optname, optval, optlen};
00275 
00276     <span class="keywordflow">return</span> rt_dev_ioctl(fd, _RTIOC_GETSOCKOPT, &amp;args);
00277 }
00278 
00279 
00280 <span class="keyword">static</span> <span class="keyword">inline</span> <span class="keywordtype">int</span> rt_dev_setsockopt(<span class="keywordtype">int</span> fd, <span class="keywordtype">int</span> level, <span class="keywordtype">int</span> optname,
00281                                     <span class="keyword">const</span> <span class="keywordtype">void</span> *optval, socklen_t optlen)
00282 {
00283     <span class="keyword">struct </span>_rtdm_setsockopt_args args =
00284     {level, optname, (<span class="keywordtype">void</span> *)optval, optlen};
00285 
00286     <span class="keywordflow">return</span> rt_dev_ioctl(fd, _RTIOC_SETSOCKOPT, &amp;args);
00287 }
00288 
00289 
00290 <span class="keyword">static</span> <span class="keyword">inline</span> <span class="keywordtype">int</span> rt_dev_bind(<span class="keywordtype">int</span> fd, <span class="keyword">const</span> <span class="keyword">struct</span> sockaddr *my_addr,
00291                               socklen_t addrlen)
00292 {
00293     <span class="keyword">struct </span>_rtdm_setsockaddr_args args = {my_addr, addrlen};
00294 
00295     <span class="keywordflow">return</span> rt_dev_ioctl(fd, _RTIOC_BIND, &amp;args);
00296 }
00297 
00298 
00299 <span class="keyword">static</span> <span class="keyword">inline</span> <span class="keywordtype">int</span> rt_dev_connect(<span class="keywordtype">int</span> fd, <span class="keyword">const</span> <span class="keyword">struct</span> sockaddr *serv_addr,
00300                                  socklen_t addrlen)
00301 {
00302     <span class="keyword">struct </span>_rtdm_setsockaddr_args args = {serv_addr, addrlen};
00303 
00304     <span class="keywordflow">return</span> rt_dev_ioctl(fd, _RTIOC_CONNECT, &amp;args);
00305 }
00306 
00307 
00308 <span class="keyword">static</span> <span class="keyword">inline</span> <span class="keywordtype">int</span> rt_dev_listen(<span class="keywordtype">int</span> fd, <span class="keywordtype">int</span> backlog)
00309 {
00310     <span class="keywordflow">return</span> rt_dev_ioctl(fd, _RTIOC_LISTEN, backlog);
00311 }
00312 
00313 
00314 <span class="keyword">static</span> <span class="keyword">inline</span> <span class="keywordtype">int</span> rt_dev_accept(<span class="keywordtype">int</span> fd, <span class="keyword">struct</span> sockaddr *addr,
00315                                 socklen_t *addrlen)
00316 {
00317     <span class="keyword">struct </span>_rtdm_getsockaddr_args args = {addr, addrlen};
00318 
00319     <span class="keywordflow">return</span> rt_dev_ioctl(fd, _RTIOC_ACCEPT, &amp;args);
00320 }
00321 
00322 
00323 <span class="keyword">static</span> <span class="keyword">inline</span> <span class="keywordtype">int</span> rt_dev_getsockname(<span class="keywordtype">int</span> fd, <span class="keyword">struct</span> sockaddr *name,
00324                                      socklen_t *namelen)
00325 {
00326     <span class="keyword">struct </span>_rtdm_getsockaddr_args args = {name, namelen};
00327 
00328     <span class="keywordflow">return</span> rt_dev_ioctl(fd, _RTIOC_GETSOCKNAME, &amp;args);
00329 }
00330 
00331 
00332 <span class="keyword">static</span> <span class="keyword">inline</span> <span class="keywordtype">int</span> rt_dev_getpeername(<span class="keywordtype">int</span> fd, <span class="keyword">struct</span> sockaddr *name,
00333                                      socklen_t *namelen)
00334 {
00335     <span class="keyword">struct </span>_rtdm_getsockaddr_args args = {name, namelen};
00336 
00337     <span class="keywordflow">return</span> rt_dev_ioctl(fd, _RTIOC_GETPEERNAME, &amp;args);
00338 }
00339 
00340 <span class="keyword">static</span> <span class="keyword">inline</span> <span class="keywordtype">int</span> rt_dev_shutdown(<span class="keywordtype">int</span> fd, <span class="keywordtype">int</span> how)
00341 {
00342     <span class="keywordflow">return</span> rt_dev_ioctl(fd, _RTIOC_SHUTDOWN, how);
00343 }
00344 
00345 <span class="preprocessor">#ifdef __cplusplus</span>
00346 <span class="preprocessor"></span>}
00347 <span class="preprocessor">#endif</span>
00348 <span class="preprocessor"></span>
00349 <span class="preprocessor">#endif </span><span class="comment">/* RTDM_NO_DEFAULT_USER_API */</span>
00350 
00351 <span class="preprocessor">#endif </span><span class="comment">/* _RTDM_H */</span>
</pre></div><hr size="1"><address style="align: right;"><small>Generated on Thu Apr 6 14:44:19 2006 for Xenomai API by&nbsp;
<a href="http://www.doxygen.org/index.html">
<img src="doxygen.png" alt="doxygen" align="middle" border="0"></a> 1.4.2 </small></address>
</body>
</html>
